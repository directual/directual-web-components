// =============================================
// Переменные — из CSS custom properties темы
// =============================================
@primary:           var(--layout-accent, #058efc);
@primary-hover:     var(--layout-accent-hover, #0062bd);
@text:              var(--layout-text, #333333);
@text-secondary:    var(--form-placeholder-disabled, #999);
@bg:                var(--layout-secondary-bgr, #fff);
@bg-disabled:       var(--form-field-bgr-disabled, #ccc);
@border:            var(--table-borders, rgba(0, 0, 0, 0.12));
@highlight:         var(--button-dropdown-hover-bgr, rgba(5, 142, 252, 0.05));
@accent-light:      var(--table-raw-hover, rgba(5, 142, 252, 0.05));
@danger:            var(--hint-error, #ff525b);
@indicator:         var(--label, #26be99);
@btn-active-bg:     var(--button-hover-bgr, #fff);
@btn-border:        var(--button-border, #8e8e8e);

// Статичные (не из темы)
@overlay-shadow:    0 5px 15px rgba(0, 0, 0, 0.25);
@event-shadow:      -1px 1px 5px 0px rgba(51, 51, 51, 0.5);
@selection-bg:      rgba(0, 0, 0, 0.5);

// Основной контейнер календаря
.calendar_wrapper {
    display: flex;
    flex-direction: column;
    background-color: #ffffff;
    border-radius: 8px;
}

/* Лоадер */
.tableLoadingOverlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(255, 255, 255, 0.8);
    z-index: 10;
  }
  
.tableLoader {
    background-color: var(--layout-main-bgr);
    padding: 20px;
    border-radius: var(--border-radius);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

// Подсветка сегодняшнего дня
:global(.rbc-today) {
    background-color: @highlight;
}

.calendar_header {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px 0;
}

.calendar_icon {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border: 2px solid @primary;
    border-radius: 12px;
    
    // Иконка календаря — primary цвет
    :global(.icon) {
        color: @primary !important;
        
        &:before {
            font-size: 24px;
            color: @primary !important;
        }
    }
}

.calendar_header_content {
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex: 1;
}

.calendar_title {
    margin: 0;
    padding: 0;
    
    h2 {
        margin: 0;
        padding: 0;
        font-size: 20px;
        font-weight: 700;
        color: @text;
        line-height: 1.3;
    }
}

.calendar_description {
    font-size: 14px;
    color: @text-secondary;
    line-height: 1.4;
    margin: 0;
}

.customToolbar {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 0 0 16px;
    background: var(--layout-secondary-bgr, #ffffff);
    border-radius: 8px;
    
    // Лейбл с датой - растягивается и выравнивается слева
    :global(.rbc-toolbar-label) {
        flex: 1;
        text-align: left !important;
        font-size: 20px;
        font-weight: 600;
        color: var(--layout-text, #333333);
        font-weight: bold;
    }
    
    // Группы кнопок
    :global(.rbc-btn-group) {
        display: flex;
        align-items: center;
    }
}

// Навигационная группа (Сегодня + стрелки)
.navGroup {
    display: flex;
    align-items: center;
}

// Обертка для стрелок
.arrowButtons {
    display: flex;
    gap: 4px;
}

// Круглые кнопки со стрелками
.arrowBtn {
    border-radius: 50% !important;
    width: 40px !important;
    min-width: 40px !important;
    height: 40px !important;
    min-height: 40px !important;
    padding: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}

// Группа с селектом вида
.viewGroup {
    display: flex;
    align-items: center;
}

.viewInput {
    margin-bottom: 0 !important;
    min-height: 48px !important;
}

.datePicker {
    display: flex;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -ms-user-select: none;
    user-select: none;
    height: 48px;
    justify-content: center;
    align-items: center;
    padding: 1px 8px;
    text-decoration: none;
    font-size: 32px;
    color: @text;
    border: solid 1px var(--button-border);
    border-radius: var(--border-radius);
    background-color: @bg;
    cursor: pointer;
    outline: none;
}

// Группа с кнопками действий
.saveGroup {
    display: flex;
    align-items: center;
}

.rbc_calendar {
    box-sizing: border-box;
    height: 100%;
    display: flex;
    flex-direction: column;    

    *,
    *:before,
    *:after {
        box-sizing: inherit;
    }

    :global(.rbc-month-view) {
        position: relative;
        border: 1px solid #ddd;
        display: flex;
        flex-direction: column;
        flex: 1 0 0;
        width: 100%;
        user-select: none;
        -webkit-user-select: none;
        height: 100%;

        :global(.rbc-month-header) {
            display: flex;
            flex-direction: row;
        }
    
        :global(.rbc-header) {
            height: 40px;
            overflow: hidden;
            flex: 1 0 0%;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: 0 3px;
            text-align: center;
            vertical-align: middle;
            font-weight: bold;
            font-size: 100%;
            min-height: 0;
            align-content: center;
            border-bottom: 1px solid #ddd;
        }
    
        :global(.rbc-header+.rbc-header) {
            border-left: 1px solid #ddd;
        }
    
        // ЗАЛУПА С САМОЙ СТРОКОЙ ДНЕЙ НЕДЕЛИ - БЕСПОЛЕЗНАЯ
    
        :global(.rbc-month-row) {
            display: flex;
            position: relative;
            flex-direction: column;
            flex: 1 0 0;
            flex-basis: 0px;
            overflow: hidden;
            height: 100%;
        }
    
        :global(.rbc-month-row+.rbc-month-row) {
            border-top: 1px solid #ddd;
        }
    
        :global(.rbc-row-bg) {
            display: flex;
            flex-direction: row;
            flex: 1 0 0;
            overflow: hidden;
            right: 1px;
            overflow: hidden;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        :global(.rbc-abs-full),
        :global(.rbc-row-bg) {
            overflow: hidden;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
    
        :global(.rbc-day-bg) {
            flex: 1 0 0%;
        }
    
        :global(.rbc-off-range-bg) {
            background: #e6e6e6;
        }
    
        :global(.rbc-day-bg+.rbc-day-bg) {
            border-left: 1px solid #ddd;
        }
    
        :global(.rbc-row-content) {
            position: relative;
            user-select: none;
            -webkit-user-select: none;
            z-index: 4;

            :global(.rbc-addons-dnd-row-body) {
                :global(.rbc-row) {
                    min-height: 0px !important;
                }
            }
        }
    
        :global(.rbc-row) {
            display: flex;
            flex-direction: row;
        }
    
        :global(.rbc-date-cell) {
            flex: 1 1 0;
            min-width: 0;
            padding-top: 4px;
            padding-left: 4px;
            text-align: left;
        }
    
        :global(.rbc-off-range) {
            color: #999;
        }
    
        :global(.rbc-button-link) {
            color: inherit;
            background: none;
            margin: 0;
            padding: 0;
            border: none;
            cursor: pointer;
            user-select: text;
            font-weight: bold;
            font-size: 14px;
        }
    
        // КОНТЕНТ В ЯЧЕЙКАХ 
        :global(.rbc-row-segment) {
            padding: 0 1px 1px 1px;
        }
    
        :global(.rbc-event),
        :global(.rbc-day-slot .rbc-background-event) {
            border: none;
            box-sizing: border-box;
            box-shadow: none;
            margin: 0;
            padding: 2px 5px;
            background-color: #3174ad;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            width: 100%;
            text-align: left;
        }
    
        // Выделение при drag по ячейкам (выбор слота)
        :global(.rbc-slot-selection) {
            z-index: 10;
            position: absolute;
            background-color: @selection-bg; // Полупрозрачный черный
            color: white;
            font-size: 75%;
            width: 100%;
            padding: 3px;
        }
        
        // Выбранная ячейка (одиночный клик)
        :global(.rbc-selected-cell) {
            background-color: @accent-light; // Легкая подсветка accent цветом
        }
        
        // Во время выбора (курсор move)
        :global(.rbc-slot-selecting) {
            cursor: move;
        }
    
        :global(.rbc-slot-selecting) {
            cursor: move;
        }
    }

    :global(.rbc-time-view) {
        display: flex;
        flex-direction: column;
        flex: 1;
        width: 100%;
        border: 1px solid #ddd;
        min-height: 0;

        // Применяется ко всем .rbc-row внутри .rbc-time-view
        // Убираем min-height, чтобы область allday схлопывалась, когда нет событий
        :global(.rbc-row) {
            box-sizing: border-box;
            min-height: 0;
        }
        // Ячейки "на весь день"
        :global(.rbc-allday-cell) {
            box-sizing: content-box;
            width: 100%;

            position: relative;

            + :global(.rbc-allday-cell) {
                border-left: 1px solid #ddd;
            }
        }

        :global(.rbc-allday-events) {
            position: relative;
            z-index: 4;
        }

        // События в области "на весь день" - как в месячном виде
        :global(.rbc-row-segment) {
            padding: 0 1px 1px 1px;
        }

        :global(.rbc-event),
        :global(.rbc-background-event) {
            border: none;
            box-sizing: border-box;
            box-shadow: none;
            margin: 0;
            padding: 2px 4px;
            background-color: #3174ad;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            width: 100%;
            text-align: left;
        }
    }

    // .rbc-time-header - отдельный блок (может быть внутри .rbc-time-view или где-то ещё)
    :global(.rbc-time-header) {
        display: flex;
        flex: 0 0 auto;
        flex-direction: row;

        :global(.rbc-label) {
            padding: 0 5px;
        }

        :global(.rbc-time-header-content) {
            flex: 1;
            display: flex;
            min-width: 0;
            flex-direction: column;
            border-left: 1px solid #ddd;

            :global(.rbc-row) {
                display: flex;
                flex-direction: row;

                :global(.rbc-header) {
                    overflow: hidden;
                    flex: 1 0 0%;
                    text-overflow: ellipsis;
                    white-space: nowrap;
                    padding: 8px 3px;
                    text-align: center;
                    vertical-align: middle;
                    font-weight: bold;
                    font-size: 90%;
                    min-height: 0;
                    align-content: center;

                    :global(.rbc-button-link) {
                        color: inherit;
                        background: none;
                        margin: 0;
                        padding: 0;
                        border: none;
                        cursor: pointer;
                        user-select: text;
                    }
                }

                // Вертикальные разделители между заголовками дней
                :global(.rbc-header + .rbc-header) {
                    border-left: 1px solid #ddd;
                }
            }
        }
    }

    :global(.rbc-time-header .rbc-overflowing) {
        border-right: 1px solid #ddd;
    }

    // === СТИЛИ ДЛЯ ДНЕВНОГО/НЕДЕЛЬНОГО ВИДА ===
    // .rbc-day-slot - контейнер для событий в time-view (неделя, день)
    :global {
        .rbc-day-slot {
            position: relative;

            .rbc-events-container {
                bottom: 0;
                left: 0;
                position: absolute;
                right: 0;
                margin-right: 10px;
                top: 0;
            }

            // События в дневном/недельном виде
            .rbc-event,
            .rbc-background-event {
                border: 1px solid #265985;
                display: flex;
                max-height: 100%;
                min-height: 20px;
                flex-flow: column wrap;
                align-items: flex-start;
                overflow: hidden;
                position: absolute;
                box-sizing: border-box;
                margin: 0;
                padding: 2px 5px;
                background-color: #3174ad;
                border-radius: 5px;
                color: #fff;
                cursor: pointer;
                text-align: left;
            }

            .rbc-background-event {
                opacity: 0.75;
            }

            .rbc-event-label {
                flex: none;
                padding-right: 5px;
                width: auto;
            }

            .rbc-event-content {
                width: 100%;
                flex: 1 1 0;
                word-wrap: break-word;
                line-height: 1;
                height: 100%;
                min-height: 1em;
            }

            .rbc-time-slot {
                border-top: 1px solid #f7f7f7;
            }
        }
    }

    // === ОБЩИЕ СТИЛИ СОБЫТИЙ (для всех видов) ===
    // Выбранное событие
    :global(.rbc-event.rbc-selected),
    :global(.rbc-day-slot .rbc-selected.rbc-background-event) {
        background-color: @primary-hover; // Темнее основного цвета
    }

    // Фокус на событии
    :global(.rbc-event:focus),
    :global(.rbc-day-slot .rbc-background-event:focus) {
        outline: 5px auto #3b99fc;
    }

    // Лейбл события
    :global(.rbc-event-label) {
        font-size: 80%;
    }

    // События с перекрытием (тень)
    :global(.rbc-event-overlaps) {
        box-shadow: @event-shadow;
    }

    // События которые продолжаются до предыдущего дня
    :global(.rbc-event-continues-prior) {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }

    // События которые продолжаются на следующий день
    :global(.rbc-event-continues-after) {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
    }

    // События которые начались раньше (в week/day view)
    :global(.rbc-event-continues-earlier) {
        border-top-left-radius: 0;
        border-top-right-radius: 0;
    }

    // События которые продолжаются позже (в week/day view)
    :global(.rbc-event-continues-later) {
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
    }

    // Во время выбора слота (drag) - события неактивны
    :global(.rbc-slot-selecting .rbc-event),
    :global(.rbc-slot-selecting .rbc-day-slot .rbc-background-event),
    :global(.rbc-day-slot .rbc-slot-selecting .rbc-background-event) {
        cursor: inherit;
        pointer-events: none;
    }

    // Таймслоты и временные колонки
    :global(.rbc-time-column) {
        display: flex;
        flex-direction: column;
        min-height: 100%;

        :global(.rbc-timeslot-group) {
            flex: 1;
        }
    }

    :global(.rbc-timeslot-group) {
        border-bottom: 1px solid #ddd;
        min-height: 40px;
        display: flex;
        flex-flow: column nowrap;
    }

    // Временные слоты
    :global(.rbc-time-slot) {
        flex: 1 0 0;

        &:global(.rbc-now) {
            font-weight: bold;
        }
    }

    // Заголовок дня (дата в week view)
    :global(.rbc-day-header) {
        text-align: center;
    }

    :global(.rbc-time-gutter),
    :global(.rbc-header-gutter) {
        flex: none;
    }

    // Стили для time-gutter (колонка с временем слева)
    :global(.rbc-time-view .rbc-time-gutter) {
        white-space: nowrap;
        text-align: right;
    }

    :global(.rbc-label) {
        padding: 0 5px;
    }

    // Контент временного вида
    :global(.rbc-time-content) {
        display: flex;
        flex: 1 0 0%;
        align-items: flex-start;
        width: 100%;
        border-top: 2px solid #ddd;
        overflow-y: auto;
        position: relative;

        > :global(.rbc-time-gutter) {
            flex: none;
        }

        > * + * > * {
            border-left: 1px solid #ddd;
        }

        > :global(.rbc-day-slot) {
            width: 100%;
            user-select: none;
        }
    }

    // Текущее время (красная линия)
    :global(.rbc-current-time-indicator) {
        position: absolute;
        z-index: 3;
        left: 0;
        right: 0;
        height: 1px;
        background-color: @indicator;
        pointer-events: none;
    }

    // Слот выбора в time view
    :global(.rbc-time-view) {
        :global(.rbc-slot-selection) {
            z-index: 10;
            position: absolute;
            background-color: @selection-bg;
            color: white;
            font-size: 75%;
            width: 100%;
            padding: 3px;
        }

        :global(.rbc-slot-selecting) {
            cursor: move;
        }
    }
}

// ЕБАНЫЙ ПОПАП КАЛЕНДАРЯ
// ======================
// OVERLAY (POPUP) - ГЛОБАЛЬНО, НАХУЙ!
// ======================
:global(.rbc-overlay) {
    position: absolute !important;
    z-index: 9999 !important;
    border: 1px solid @border;
    background-color: var(--layout-secondary-bgr, #fff) !important;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.25) !important;
    padding: 10px !important;
    border-radius: 4px;
    min-width: 200px;

    :global(.rbc-event),
    :global(.rbc-day-slot .rbc-background-event) {
        border: none;
        box-sizing: border-box;
        box-shadow: none;
        margin: 0;
        padding: 2px 5px;
        background-color: #3174ad;
        border-radius: 5px;
        color: #fff;
        cursor: pointer;
        width: 100%;
        text-align: left;
    }

    :global(.rbc-event+ .rbc-event) {
        margin-top: 2px;
    }

    :global(.rbc-row-segment) {
        padding: 1px 1px 1px 1px;
    }
}

// Заголовок overlay
:global(.rbc-overlay-header) {
    border-bottom: 1px solid @border;
    margin: -10px -10px 5px -10px;
    padding: 2px 10px;
    font-weight: 600;
}

// События которые продолжаются на следующий день
:global(.rbc-event-continues-after) {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
}

// === AGENDA VIEW (СПИСОК СОБЫТИЙ) ===
:global(.rbc-agenda-view) {
    display: flex;
    flex-direction: column;
    flex: 1 0 0;
    overflow: auto;

    table:global(.rbc-agenda-table) {
        width: 100%;
        border: 1px solid #ddd;
        border-spacing: 0;
        border-collapse: collapse;

        // Ячейки таблицы
        tbody > tr > td {
            padding: 10px 15px; // Увеличил с 5px 10px для большей высоты строк
            vertical-align: middle; // Поменял с top на middle для центрирования
        }

        // Ячейка со временем
        :global(.rbc-agenda-time-cell) {
            padding-left: 20px;
            padding-right: 20px;
            text-transform: lowercase;
        }

        // Разделители между колонками
        tbody > tr > td + td {
            border-left: 1px solid #ddd;
        }

        // Разделители между строками
        tbody > tr + tr {
            border-top: 1px solid #ddd;
        }

        // Заголовки таблицы
        thead > tr > th {
            padding: 3px 5px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
    }
}

// Ячейка со временем (общая)
:global(.rbc-agenda-time-cell) {
    text-transform: lowercase;

    // Индикатор продолжения события
    :global(.rbc-continues-after):after {
        content: " »";
    }

    :global(.rbc-continues-prior):before {
        content: "« ";
    }
}

// Ячейки с датой и временем (без переноса)
:global(.rbc-agenda-date-cell),
:global(.rbc-agenda-time-cell) {
    white-space: nowrap;
}

// Ячейка с событием (на всю ширину)
:global(.rbc-agenda-event-cell) {
    width: 100%;
}